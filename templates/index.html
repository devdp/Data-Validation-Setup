<html>

<head>
    <!-- JQuery -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!-- Bootstrap tooltips -->
    <script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.4/umd/popper.min.js"></script>
    <!-- Bootstrap core JavaScript -->
    <script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.0/js/bootstrap.min.js"></script>
    <!-- MDB core JavaScript -->
    <script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.1/js/mdb.min.js"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css">
    <!-- Google Fonts -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap">
    <!-- Bootstrap core CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.0/css/bootstrap.min.css" rel="stylesheet">
    <!-- Material Design Bootstrap -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.1/css/mdb.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.js"
        integrity="sha512-dqw6X88iGgZlTsONxZK9ePmJEFrmHwpuMrsUChjAw1mRUhUITE5QU9pkcSox+ynfLhL15Sv2al5A0LVyDCmtUw=="
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css"
        integrity="sha512-8bHTC73gkZ7rZ7vpqUQThUDhqcNFyYi2xgDgPDHc+GXVGHXq+xPjynxIopALmOPqzo9JZj0k6OqqewdGO3EsrQ=="
        crossorigin="anonymous" />
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.21/css/jquery.dataTables.css">
    <script type="text/javascript" charset="utf8"
        src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.js"></script>
    <script type="text/javascript" charset="utf8"
        src="https://cdn.datatables.net/buttons/1.6.2/js/dataTables.buttons.min.js"></script>

    <script type="text/javascript" charset="utf8"
        src="https://cdn.datatables.net/buttons/1.6.2/js/buttons.flash.min.js"></script>
    <script type="text/javascript" charset="utf8"
        src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script type="text/javascript" charset="utf8"
        src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
    <script type="text/javascript" charset="utf8"
        src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
    <script type="text/javascript" charset="utf8"
        src="https://cdn.datatables.net/buttons/1.6.2/js/buttons.html5.min.js"></script>
    <script type="text/javascript" charset="utf8"
        src="https://cdn.datatables.net/buttons/1.6.2/js/buttons.print.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.21/css/jquery.dataTables.min.css">
    <link rel="stylesheet" type="text/css"
        href="https://cdn.datatables.net/buttons/1.6.2/css/buttons.dataTables.min.css">
    <script>
        $(document).ready(function () {
            $(".item").click(function () {
                $(".item").removeClass("active");
                $(this).addClass("active");
            });
        });

        var role = "{{user}}";

        function addrecord() {
            document.getElementById('add').style.display = 'inline';
            document.getElementById('view').style.display = 'none';
            document.getElementById('newuser').style.display = 'none';
        }

        function viewdata() {
            document.getElementById('add').style.display = 'none';
            document.getElementById('newuser').style.display = 'none';
            if (role == 'all') {
                document.getElementById('view').style.display = 'inline';
            }

            else {
                document.getElementById('view').style.display = 'none';
            }
            }
            
            function refresh(){
            
                $(function () {
                    $("#table").DataTable({
                        retrieve: true,
dom: 'Bfrtip',
                        buttons: [
                            'copy', 'csv', 'excel', 'pdf', 'print'
                        ]
                    });

                    // Premade test data, you can also use your own
                    var testDataUrl = "http://ec2-18-223-38-113.us-east-2.compute.amazonaws.com:7002/getdata"
                    $.ajax({
                        type: 'GET',
                        url: testDataUrl,
                        contentType: "text/plain",
                        dataType: 'json',
                        success: function (data) {
                            myJsonData = data;
                            populateDataTable(myJsonData);
                        }
                    });

                    // populate the data table with JSON data
                    function populateDataTable(data) {
                        // clear the table before populating it with more data
                        $("#table").DataTable().clear();
                        var length = Object.keys(data.data).length;
                        for (var i = 0; i < length + 1; i++) {
                            var d = data.data['s' + i];

                            // You could also use an ajax property on the data table initialization
                            $('#table').dataTable().fnAddData([
                                d.timestamp,
                                d.user,
                                d.order_number,
                                d.trans_id,
                                d.Amount
                            ]);
                        }
                    }
                })();
            

        }

        function newuser() {
            document.getElementById('view').style.display = 'none';
            document.getElementById('add').style.display = 'none';
            if (role == 'all') {
                document.getElementById('newuser').style.display = 'inline';
            }
            else {
                document.getElementById('newuser').style.display = 'none';
            }
        }

        function update() {
            var ord = document.getElementById('ordnum').value;
            var trans = document.getElementById('transid').value;
            var amt = document.getElementById('amt').value;
            $.get('/update', { ord: ord, trans: trans, amt: amt }).done(function (data) {
            if(data=='success'){
    html = '<div class="alert alert-danger" role="alert">Successfully Updated</div>';
                document.getElementById('para').innerHTML = html;
}
else{
alert(data);
}
            });
            $('#add input').each(function () {
                $(this).val('');
html=' ';
document.getElementById('para').innerHTML =html;
});        }

        function newusercreate() {
            var user_name = document.getElementById('user_name').value;
            var user_password = document.getElementById('user_pass').value;
            var e = document.getElementById("sel");
            var user_role = e.options[e.selectedIndex].value;
            $.get('/newuser', { user_name: user_name, user_password: user_password, user_role: user_role }).done(function (data) {
                alert(data);
            })
            $('#newuser input').each(function () {
                $(this).val('');
            });
        }
    </script>
    <style>
        .column {
            float: left;
            width: 50%;
            padding: 10px;
            height: 300px;
            /* Should be removed. Only for demonstration */
        }

        /* Clear floats after the columns */
        .row:after {
            content: "";
            display: table;
            clear: both;
        }

        .info-color {
            background-color: background-color: #a4508b;
            background-image: linear-gradient(326deg, #a4508b 0%, #5f0a87 74%);
        }
    </style>
</head>

<body style="background: #f2f2f2;">
    <div class="ui inverted segment">
        <div class="ui inverted secondary pointing menu">
            <a class="active item" onclick="addrecord()">
                Add Record
            </a>
            <a class="item" onclick="viewdata()">
                View Data
            </a>
            <a class="item" onclick="newuser()">
                Create User
            </a>
            <div class="right menu">
                <a class="item" href="http://ec2-18-223-38-113.us-east-2.compute.amazonaws.com:7002">
                    LogOut
                </a>
            </div>
        </div>
    </div>
    <div class="row" id="add" style="display: inline;">
        <div class="column">
            <div>
                <!-- Material form contact -->
                <div class="card">

                    <h5 class="card-header info-color white-text text-center py-4">
                        <strong>Record New Entry</strong>
                    </h5>

                    <!--Card content-->
                    <div class="card-body px-lg-5 pt-0">

                        <!-- Form -->
                        <div class="text-center" style="color: #757575;">

                            <div class="md-form mt-3">
                                <input type="text" id="ordnum" class="form-control">
                                <label for="materialContactFormName">Order Number</label>
                            </div>
                            <div class="md-form">
                                <input type="text" id="transid" class="form-control">
                                <label for="materialContactFormEmail">Transaction ID</label>
                            </div>
                            <div class="md-form">
                                <input type="text" id="amt" class="form-control">
                                <label for="materialContactFormEmail">Amount</label>
                            </div>
                            <button class="btn btn-outline-info btn-rounded btn-block z-depth-0 my-4 waves-effect"
                                onclick="update()">Submit</button>
<br>
<div class="md-form" align="middle">
<div id="para"></div>
</div>

                        </div>
                        <!-- Form -->

                    </div>

                </div>
                <!-- Material form contact -->
            </div>
        </div>
        <div class="column">
            <div style="display:none;">
                <div class="card">
                    <h5 class="card-header info-color white-text text-center py-4">
                        <strong>Update Status</strong>
                    </h5>

                    <!--Card content-->
                    <div class="card-body px-lg-5 pt-0">

                        <!-- Form -->
                        <br>
                        <br>
                        <div id="alt" class="text-center" style="color: #757575;">

                        </div>
                        <!-- Form -->

                    </div>
                </div>
            </div>
        </div>
    </div>
    <div style="display: inline;">
        <div id="view" style="display: none;">
            <div align="middle">
                <button type="button" class="btn btn-outline-secondary btn-rounded waves-effect" onclick="refresh()">Refresh</button>
            </div>
            <table class="ui red table" id="table">
                <thead>
                    <tr>
                        <th>TimeStamp</th>
                        <th>Recorded By</th>
                        <th>Order Number</th>
                        <th>Transaction ID</th>
                        <th>Amount</th>
                    </tr>
                </thead>
                <tbody id="tab">

                </tbody>
            </table>
        </div>
    </div>
    <div align="middle" style="width: 40%;">
        <div id="newuser" style="display: none;">
            <!-- Material form contact -->
            <div class="card">

                <h5 class="card-header info-color white-text text-center py-4">
                    <strong>Create New User</strong>
                </h5>

                <!--Card content-->
                <div class="card-body px-lg-5 pt-0">

                    <!-- Form -->
                    <div class="text-center" style="color: #757575;">

                        <!-- Name -->
                        <div class="md-form mt-3">
                            <input type="text" id="user_name" class="form-control">
                            <label for="materialContactFormName">Username</label>
                        </div>
                        <div class="md-form mt-3">
                            <input type="password" id="user_pass" class="form-control">
                            <label for="materialContactFormName">Password</label>
                        </div>

                        <!-- Subject -->
                        <span>Access</span>
                        <select id="sel" class="mdb-select">
                            <option value="" disabled>Choose option</option>
                            <option value="limited" selected>Limited</option>
                            <option value="all">All</option>
                        </select>

                        <!-- Send button -->
                        <button class="btn btn-outline-info btn-rounded btn-block z-depth-0 my-4 waves-effect"
                            onclick="newusercreate()">Create User</button>
                    </div>
                    <!-- Form -->
                </div>
            </div>
            <!-- Material form contact -->
        </div>
    </div>
</body>

</html>
